<!DOCTYPE html>
<html lang="en-US">

<!--
EMDA 203 - Project_1_2 Template - Spring 2020.
Place the assets on a canvas using JavaScript and CreateJS.
Set up procedural target movement and keyboard input for hero movement.
-->

<head>
	<meta charset="UTF-8">
	<title>Sean Walters - Project 1_2</title>
	<script src="https://code.createjs.com/1.0.0/createjs.min.js"></script>
	<script src="js/KeyMonkey.js"></script>
	<script src="js/collisionGnome.js"></script>
	<script>
		// GLOBAL VARIABLES
		var myFrameRate = 200;
		// STAGE
		var myStage;
		var stageWidth;
		var stageHeight;
		// OBJECTS
		var bg;
		var hero;
		var target_1;
		var target_2;
		var target_3;
		// START POSITIONS
		var heroStartPositionX = 800;
		var heroStartPositionY = 450;
		// SPEEDS
		var heroStartSpeed = 1;
		// ACTUAL MAX SPEED WILL BE targetMaxSpeed + targetMinSpeed
		var targetMinSpeed = 1;
		var targetMaxSpeed = 1;
		// INITIALIZATION - HAPPENS ONLY ONCE
		function init() {
			myStage = new createjs.Stage(document.getElementById("myCanvas"));
			stageWidth = myStage.canvas.width;
			stageHeight = myStage.canvas.height;
			createjs.Ticker.addEventListener('tick', gameLoop);
			createjs.Ticker._setFPS(myFrameRate);
			initGame();
		}
		// END init()
		function initGame() {
			// BITMAPS
			bg = new createjs.Bitmap("img/bg_new.png");
			hero = new createjs.Bitmap("img/box_head_2.png");
			target_1 = new createjs.Bitmap("img/tri_eye_2.png");
			target_2 = new createjs.Bitmap("img/circ_face_2.png");
			target_3 = new createjs.Bitmap("img/key.png");
			// REGISTER POINTS
			bg.regX = 0;
			bg.regY = 0;
			hero.regX = 64;
			hero.regY = 64;
			target_1.regX = 64;
			target_1.regY = 64;
			target_2.regX = 64;
			target_2.regY = 64;
			target_3.regX = 64;
			target_3.regY = 64;
			// POSITIONS
			bg.x = 0;
			bg.y = 0;
			hero.x = Math.random() * 0.92 * stageWidth + 64;
			hero.y = Math.random() * 0.85 * stageHeight + 64;
			target_1.x = Math.random() * 0.92 * stageWidth + 64;
			target_1.y = Math.random() * 0.85 * stageHeight + 64;
			target_2.x = Math.random() * 0.92 * stageWidth + 64;
			target_2.y = Math.random() * 0.85 * stageHeight + 64;
			target_3.x = Math.random() * 0.92 * stageWidth + 64;
			target_3.y = Math.random() * 0.85 * stageHeight + 64;
			// SPEEDS
			hero.speed = heroStartSpeed;
			target_1.xSpeed = Math.random() * targetMaxSpeed + targetMinSpeed;
			target_1.ySpeed = Math.random() * targetMaxSpeed + targetMinSpeed;
			target_2.speed = Math.random() * targetMaxSpeed + targetMinSpeed;
			target_3.speed = Math.random() * targetMaxSpeed + targetMinSpeed;
			// LAYERS
			myStage.addChild(bg);
			myStage.addChild(target_3);
			myStage.addChild(target_2);
			myStage.addChild(target_1);
			myStage.addChild(hero);
		}
		// THE MAIN LOOP
		function gameLoop(evt) {
			// PUT CODE IN HERE THAT WILL CHANGE EVERY 'TICK'
			// CHECK FOR KEYBOARD INPUT
			handleKeyboardInput();

			// HERO LOOPS AROUND STAGE EDGE
			if (hero.x < 0) {
				hero.x = stageWidth;
			}
			else if (hero.x > stageWidth) {
				hero.x = 0;
			}
			if (hero.y < 0) {
				hero.y = stageHeight;
			}
			else if (hero.y > stageHeight) {
				hero.y = 0;
			}

			// IF TARGET HITS HERO
			if ((hero.x + 100) > hero.x > (hero.x - 100) == target_1.x) {
				hero.speed = 0;
				target_1.xSpeed = 0;
				target_1.ySpeed = 0;
				console.log("hit");
			}

			// MOVE TARGETS
			// moveTarget(target_1);
			// moveTarget(target_2);
			// moveTarget(target_3);
			// target_1.y += target_1.ySpeed;

			target_1.x += target_1.xSpeed;
			target_1.y += target_1.ySpeed;

			if (target_1.x >= (stageWidth - 64) || target_1.x <= 64) {
				target_1.xSpeed = target_1.xSpeed * -1;
				if (target_1.x <= 200 && target_1.y <= 200 || target_1.x <= 200 && target_1.y >= 700 || target_1.x >= 1400 && target_1.y <= 200 || target_1.x >= 200 && target_1.y >= 1400) {
					target_1.xSpeed = target_1.xSpeed * 1.1;
					target_1.ySpeed = target_1.ySpeed * 1.1;
					console.log(Math.round(target_1.xSpeed) + " + " + Math.round(target_1.x) + " + " + Math.round(target_1.y));
				}
			}
			if (target_1.y >= (stageHeight - 64) || target_1.y <= 64) {
				target_1.ySpeed = target_1.ySpeed * -1;
				if (target_1.x <= 200 && target_1.y <= 200 || target_1.x <= 200 && target_1.y >= 700 || target_1.x >= 1400 && target_1.y <= 200 || target_1.x >= 200 && target_1.y >= 1400) {
					target_1.xSpeed = target_1.xSpeed * 1.1;
					target_1.ySpeed = target_1.ySpeed * 1.1;
					console.log(Math.round(target_1.xSpeed) + " + " + Math.round(target_1.x) + " + " + Math.round(target_1.y));
				}
			}
			// RESET TARGET
			if (target_1.xSpeed >= 20000) {
				target_1.x = Math.random() * 0.92 * stageWidth + 64;
				target_1.y = Math.random() * 0.85 * stageHeight + 64;
				target_1.xSpeed = Math.random() * targetMaxSpeed + targetMinSpeed;
				target_1.ySpeed = Math.random() * targetMaxSpeed + targetMinSpeed;
				console.log("reset 'target_1'");
			}
			myStage.update();
		}
		// END drawNewFrame()
		// KEYBOARD INPUT FUNCTION
		function handleKeyboardInput() {
			// WRITE CODE TO ALLOW KEY STROKES TO CONTROL MOVEMENT OF YOUR HERO
			// FOR EXAMPLE:
			if (keyMonkey["w"] || keyMonkey["up"]) { hero.y -= hero.speed; }
			if (keyMonkey["s"] || keyMonkey["down"]) { hero.y += hero.speed; }
			if (keyMonkey["d"] || keyMonkey["right"]) { hero.x += hero.speed; }
			if (keyMonkey["a"] || keyMonkey["left"]) { hero.x -= hero.speed; }
		}
		// END handleKeyboardInput()
		// MOVE TARGET FUNCTION
		// function moveTarget(thisTarget) {
		// 	thisTarget.y += thisTarget.speed;
		// }
		// END moveTarget()
	</script>
</head>

<body onload="init()">
	<canvas id="myCanvas" width="1600" height="900">Sorry. You need an HTML5 compatible browser to see this.</canvas>
</body>

</html>